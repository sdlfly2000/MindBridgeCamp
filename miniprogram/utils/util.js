"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.GetLocalUserInformation = exports.Login = exports.IsLoginTokenValid = exports.UpdateUserInfo = exports.webClient = exports.FormatTime = exports.FormatDate = exports.formatTime = void 0;
exports.formatTime = function (date) {
    var year = date.getFullYear();
    var month = date.getMonth() + 1;
    var day = date.getDate();
    var hour = date.getHours();
    var minute = date.getMinutes();
    var second = date.getSeconds();
    return ([year, month, day].map(formatNumber).join('-') +
        ' ' +
        [hour, minute, second].map(formatNumber).join(':'));
};
var formatNumber = function (n) {
    var s = n.toString();
    return s[1] ? s : '0' + s;
};
exports.FormatDate = function (date) {
    return [date.getFullYear(), date.getMonth() + 1, date.getDate()].map(formatNumber).join('-');
};
exports.FormatTime = function (date) {
    return [date.getHours(), date.getMinutes()].map(formatNumber).join(':');
};
exports.webClient = function (url, httpMethod, requestData) {
    return new Promise(function (resolve, error) {
        wx.request({
            url: url,
            method: httpMethod,
            data: requestData,
            success: function (res) {
                if (res.statusCode == 200) {
                    resolve(res);
                }
                else {
                    error(res);
                }
            },
            fail: function (e) {
                console.error(e);
            }
        });
    });
};
exports.UpdateUserInfo = function (app, userInfo) {
    var loginToken = wx.getStorageSync("LoginToken");
    var updateUserInfoUrl = app.globalData.baseUrlApp + "User/UpdateUserInfo/" + loginToken;
    var userInfoData = {
        NickName: userInfo.NickName,
        AvatarUrl: userInfo.AvatarUrl,
        Country: userInfo.Country,
        Province: userInfo.Province,
        City: userInfo.City,
        Language: userInfo.Language
    };
    exports.webClient(updateUserInfoUrl, "POST", userInfoData)
        .catch(function (res) { return console.error(res); });
};
exports.IsLoginTokenValid = function (app) {
    var loginToken = wx.getStorageSync("LoginToken");
    return new Promise(function (resolve, error) {
        if (loginToken == '') {
            error("LoginToken is undefined");
        }
        else {
            wx.request({
                url: app.globalData.baseUrlAuth + "WeixinLogin/IsLoginTokenValid/" + loginToken,
                success: function (res) {
                    if (res.statusCode == 200) {
                        resolve(res);
                    }
                    else {
                        error(res);
                    }
                },
                fail: function (e) {
                    console.error(e);
                }
            });
        }
    });
};
exports.Login = function (app) {
    return new Promise(function (resolve) {
        wx.login({
            success: function (res) {
                console.info("Login Code: " + res.code);
                wx.request({
                    url: app.globalData.baseUrlAuth + "WeixinLogin/GetToken",
                    data: {
                        LoginCode: res.code,
                        AppName: app.globalData.appName
                    },
                    header: {
                        'content-type': 'application/json'
                    },
                    method: 'POST',
                    success: function (response) {
                        if (response.data != undefined) {
                            wx.setStorageSync('LoginToken', response.data);
                            console.info("Login Token: " + response.data);
                            resolve(response);
                        }
                    }
                });
            },
        });
    });
};
exports.GetLocalUserInformation = function (app) {
    wx.getSetting({
        success: function (res) {
            if (res.authSetting['scope.userInfo']) {
                wx.getUserInfo({
                    success: function (res) {
                        app.globalData.userInfo = res.userInfo;
                        if (app.userInfoReadyCallback) {
                            app.userInfoReadyCallback(res);
                        }
                    }
                });
            }
        }
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQWEsUUFBQSxVQUFVLEdBQUcsVUFBQyxJQUFVO0lBQ25DLElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQTtJQUMvQixJQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ2pDLElBQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQTtJQUMxQixJQUFNLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUE7SUFDNUIsSUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFBO0lBQ2hDLElBQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQTtJQUVoQyxPQUFPLENBQ0wsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO1FBQzlDLEdBQUc7UUFDSCxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FDbkQsQ0FBQTtBQUNILENBQUMsQ0FBQTtBQUVELElBQU0sWUFBWSxHQUFHLFVBQUMsQ0FBUztJQUM3QixJQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUE7SUFDdEIsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQTtBQUMzQixDQUFDLENBQUE7QUFFWSxRQUFBLFVBQVUsR0FBRyxVQUFTLElBQVU7SUFDM0MsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsRUFBRSxJQUFJLENBQUMsUUFB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RSxVQUFBLEdBQUc7WUFDVixJQUFHLEdBQUcsQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsRUFBQztnQkFDbkMsRUFBRSxDQUFDLFdBQVcsQ0FBQztvQkFDYixPQUFPLEVBQUUsVUFBQSxHQUFHO3dCQUNWLEdBQUcsQ0FBQyxVQUFVLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUM7d0JBQ3ZDLElBQUcsR0FBRyxDQUFDLHFCQUFxQixFQUFDOzRCQUMzQixHQUFHLENBQUMscUJBQXFCLENBQUMsR0FBRyxDQUFDLENBQUM7eUJBQ2hDO29CQUNILENBQUM7aUJBQ0YsQ0FBQyxDQUFBO2FBQ0g7UUFDSCxDQUFDO0tBQ0YsQ0FBQyxDQUFBO0FBQ0osQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IGZvcm1hdFRpbWUgPSAoZGF0ZTogRGF0ZSkgPT4ge1xyXG4gIGNvbnN0IHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKClcclxuICBjb25zdCBtb250aCA9IGRhdGUuZ2V0TW9udGgoKSArIDFcclxuICBjb25zdCBkYXkgPSBkYXRlLmdldERhdGUoKVxyXG4gIGNvbnN0IGhvdXIgPSBkYXRlLmdldEhvdXJzKClcclxuICBjb25zdCBtaW51dGUgPSBkYXRlLmdldE1pbnV0ZXMoKVxyXG4gIGNvbnN0IHNlY29uZCA9IGRhdGUuZ2V0U2Vjb25kcygpXHJcblxyXG4gIHJldHVybiAoXHJcbiAgICBbeWVhciwgbW9udGgsIGRheV0ubWFwKGZvcm1hdE51bWJlcikuam9pbignLScpICtcclxuICAgICcgJyArXHJcbiAgICBbaG91ciwgbWludXRlLCBzZWNvbmRdLm1hcChmb3JtYXROdW1iZXIpLmpvaW4oJzonKVxyXG4gIClcclxufVxyXG5cclxuY29uc3QgZm9ybWF0TnVtYmVyID0gKG46IG51bWJlcikgPT4ge1xyXG4gIGNvbnN0IHMgPSBuLnRvU3RyaW5nKClcclxuICByZXR1cm4gc1sxXSA/IHMgOiAnMCcgKyBzXHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBGb3JtYXREYXRlID0gZnVuY3Rpb24oZGF0ZTogRGF0ZSl7XHJcbiAgcmV0dXJuIFtkYXRlLmdldEZ1bGxZZWFyKCksIGRhdGUuZ2V0TW9udGgoKSArIDEsIGRhdGUuZ2V0RGF0ZSgpXS5tYXAoZm9ybWF0TnVtYmVyKS5qb2luKCctJyk7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBGb3JtYXRUaW1lID0gZnVuY3Rpb24oZGF0ZTogRGF0ZSl7XHJcbiAgcmV0dXJuIFtkYXRlLmdldEhvdXJzKCksIGRhdGUuZ2V0TWludXRlcygpXS5tYXAoZm9ybWF0TnVtYmVyKS5qb2luKCc6Jyk7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCB3ZWJDbGllbnQgPSBmdW5jdGlvbih1cmw6IHN0cmluZywgaHR0cE1ldGhvZD86IGFueSwgcmVxdWVzdERhdGE/OiBhbnkpe1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZShcclxuICAgIChyZXNvbHZlLCBlcnJvcikgPT4ge1xyXG4gICAgICB3eC5yZXF1ZXN0KHtcclxuICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICBtZXRob2Q6IGh0dHBNZXRob2QsXHJcbiAgICAgICAgZGF0YTogcmVxdWVzdERhdGEsXHJcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKXtcclxuICAgICAgICAgIGlmKHJlcy5zdGF0dXNDb2RlID09IDIwMCl7XHJcbiAgICAgICAgICAgIHJlc29sdmUocmVzKTsgICAgICAgICAgICBcclxuICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBlcnJvcihyZXMpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZmFpbDogZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgKTtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IFVwZGF0ZVVzZXJJbmZvID0gZnVuY3Rpb24oYXBwOiBJQXBwT3B0aW9uLCB1c2VySW5mbzogYW55KXtcclxuICBsZXQgbG9naW5Ub2tlbjpzdHJpbmcgPSB3eC5nZXRTdG9yYWdlU3luYyhcIkxvZ2luVG9rZW5cIik7XHJcbiAgbGV0IHVwZGF0ZVVzZXJJbmZvVXJsOiBzdHJpbmcgPSBhcHAuZ2xvYmFsRGF0YS5iYXNlVXJsQXBwICsgXCJVc2VyL1VwZGF0ZVVzZXJJbmZvL1wiICsgbG9naW5Ub2tlbjtcclxuICBsZXQgdXNlckluZm9EYXRhID0ge1xyXG5cdE5pY2tOYW1lOiB1c2VySW5mby5OaWNrTmFtZSxcclxuXHRBdmF0YXJVcmw6IHVzZXJJbmZvLkF2YXRhclVybCxcclxuXHRDb3VudHJ5OiB1c2VySW5mby5Db3VudHJ5LFxyXG5cdFByb3ZpbmNlOiB1c2VySW5mby5Qcm92aW5jZSxcclxuXHRDaXR5OiB1c2VySW5mby5DaXR5LFxyXG5cdExhbmd1YWdlOiB1c2VySW5mby5MYW5ndWFnZVxyXG4gIH1cclxuICB3ZWJDbGllbnQodXBkYXRlVXNlckluZm9VcmwsIFwiUE9TVFwiLCB1c2VySW5mb0RhdGEpXHJcblx0LmNhdGNoKChyZXMpID0+IGNvbnNvbGUuZXJyb3IocmVzKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBJc0xvZ2luVG9rZW5WYWxpZCA9IGZ1bmN0aW9uKGFwcDogSUFwcE9wdGlvbil7XHJcbiAgbGV0IGxvZ2luVG9rZW46c3RyaW5nID0gd3guZ2V0U3RvcmFnZVN5bmMoXCJMb2dpblRva2VuXCIpO1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZShcclxuICAgIChyZXNvbHZlLCBlcnJvcikgPT4ge1xyXG4gICAgICBpZihsb2dpblRva2VuID09ICcnKXtcclxuICAgICAgICBlcnJvcihcIkxvZ2luVG9rZW4gaXMgdW5kZWZpbmVkXCIpO1xyXG4gICAgICB9ZWxzZXtcclxuICAgICAgICB3eC5yZXF1ZXN0KHtcclxuICAgICAgICAgIHVybDogYXBwLmdsb2JhbERhdGEuYmFzZVVybEF1dGggKyBcIldlaXhpbkxvZ2luL0lzTG9naW5Ub2tlblZhbGlkL1wiICsgbG9naW5Ub2tlbixcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcyl7XHJcbiAgICAgICAgICAgIGlmKHJlcy5zdGF0dXNDb2RlID09IDIwMCl7XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZShyZXMpO1xyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICBlcnJvcihyZXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZmFpbDogZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICApO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgTG9naW4gPSBmdW5jdGlvbihhcHA6IElBcHBPcHRpb24pe1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZShcclxuICAgIChyZXNvbHZlKSA9PiB7XHJcbiAgICAgIHd4LmxvZ2luKHtcclxuICAgICAgICBzdWNjZXNzOiByZXMgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5pbmZvKFwiTG9naW4gQ29kZTogXCIgKyByZXMuY29kZSk7ICAgICAgXHJcbiAgICAgICAgICB3eC5yZXF1ZXN0KHtcclxuICAgICAgICAgICAgdXJsOiBhcHAuZ2xvYmFsRGF0YS5iYXNlVXJsQXV0aCArIFwiV2VpeGluTG9naW4vR2V0VG9rZW5cIixcclxuICAgICAgICAgICAgZGF0YTp7XHJcbiAgICAgICAgICAgICAgTG9naW5Db2RlOiByZXMuY29kZSxcclxuICAgICAgICAgICAgICBBcHBOYW1lOiBhcHAuZ2xvYmFsRGF0YS5hcHBOYW1lXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGhlYWRlcjoge1xyXG4gICAgICAgICAgICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKXsgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YSAhPSB1bmRlZmluZWQpe1xyXG4gICAgICAgICAgICAgICAgd3guc2V0U3RvcmFnZVN5bmMoJ0xvZ2luVG9rZW4nLCByZXNwb25zZS5kYXRhKVxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiTG9naW4gVG9rZW46IFwiICsgcmVzcG9uc2UuZGF0YSk7IFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pIFxyXG4gICAgfVxyXG4gICkgXHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBHZXRMb2NhbFVzZXJJbmZvcm1hdGlvbiA9IGZ1bmN0aW9uKGFwcDogSUFwcE9wdGlvbil7XHJcbiAgd3guZ2V0U2V0dGluZyh7XHJcbiAgICBzdWNjZXNzOiByZXMgPT4ge1xyXG4gICAgICBpZihyZXMuYXV0aFNldHRpbmdbJ3Njb3BlLnVzZXJJbmZvJ10pe1xyXG4gICAgICAgIHd4LmdldFVzZXJJbmZvKHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IHJlcyA9PiB7XHJcbiAgICAgICAgICAgIGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvID0gcmVzLnVzZXJJbmZvO1xyXG4gICAgICAgICAgICBpZihhcHAudXNlckluZm9SZWFkeUNhbGxiYWNrKXtcclxuICAgICAgICAgICAgICBhcHAudXNlckluZm9SZWFkeUNhbGxiYWNrKHJlcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSlcclxufVxyXG4iXX0=